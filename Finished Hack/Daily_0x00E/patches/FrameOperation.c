// @Description code will be excute once every frame, modified from UnlimitedRockBouncing
// @HookAddress 0x6C75E
// @EntryFunctionSymbol FrameOperations
// Mode: Thumb
// Made by Goldensunboy, ssp(shinespeciall)

/* Hook details
------------------------- this only works when the new function push lr at first and bx lr at last.
0x806C75E: LDR R0, 0x806C767    | 4803
0x806C760: MOV LR, R0           | 4686
0x806C762: LDR R0, pointer      | 4801
0x806C764: BX R0                | 4700
0x806C766: B 0x806C770          | E002
0x806C768: .fill a pointer      | 0XXXXXXX ; end with 1 (in binary) to make it run in thumb mode
0x806C76C: .fill 67C70608       | 0806C767 ; end with 1 (in binary) to make it run in thumb mode
0x806C770: nop                  | 46C0     ; i.e. mov r8, r8
0x806C772: nop....
-------------------------
Hook String:
@HookString 03 48 86 46 01 48 00 47 02 E0 P 67 C7 06 08 C0 46 C0 46 C0 46 C0 46 C0 46 C0 46 C0 46 C0 46 C0 46 C0 46
count:                                     ^14                                                                     ^38
Hook length: 38 Bytes
*/

// my variables
#define unk_300001F (*(volatile unsigned char*) 0x300001F)
#define unk_3000039 (*(volatile unsigned char*) 0x3000039)

// IO
#define REG_BG0CNT (*(volatile unsigned short*) 0x4000008)
#define REG_BG1CNT (*(volatile unsigned short*) 0x400000A)
#define REG_BG2CNT (*(volatile unsigned short*) 0x400000C)
#define REG_BG3CNT (*(volatile unsigned short*) 0x400000E)

#define GameState (*(volatile unsigned char*) 0x3000C3C)
#define unk_300001B (*(volatile unsigned char*) 0x300001B)
#define ucObjPriFlg (*(volatile unsigned char*) 0x3000033)
#define unk_3000046 (*(volatile unsigned char*) 0x3000046)

#define CurrentRoomHeader_TilesetId (*(volatile unsigned char*) 0x3000074)
#define CurrentRoomHeader_Layer0MappingType (*(volatile unsigned char*) 0x3000075)
#define CurrentRoomHeader_Layer1MappingType (*(volatile unsigned char*) 0x3000076)
#define CurrentRoomHeader_Layer2MappingType (*(volatile unsigned char*) 0x3000077)
#define CurrentRoomHeader_Layer3MappingType (*(volatile unsigned char*) 0x3000078)

#define CurrentRoomHeader_Layer0CompressedDataPointer ((volatile unsigned char**) 0x300007C)
#define CurrentRoomHeader_Layer1CompressedDataPointer ((volatile unsigned char**) 0x3000080)
#define CurrentRoomHeader_Layer2CompressedDataPointer ((volatile unsigned char**) 0x3000084)
#define CurrentRoomHeader_Layer3CompressedDataPointer ((volatile unsigned char**) 0x3000088)

#define CurrentRoomHeader_LayerPriorityALphaParam (*(volatile unsigned char*) 0x300008e)

// font Tile8x8 and palette data
const unsigned char FontTiles[4096] __attribute__((aligned(4)))=
{
    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x22,0x22,0x32,
    0x23,0x12,0x11,0x22,0x23,0x21,0x22,0x21,0x23,0x21,0x23,0x21,0x22,0x21,0x23,0x21,
    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x22,0x32,
    0x33,0x22,0x12,0x32,0x33,0x12,0x11,0x32,0x33,0x22,0x21,0x32,0x33,0x23,0x21,0x33,
    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x22,0x22,0x32,
    0x23,0x12,0x11,0x22,0x23,0x21,0x22,0x21,0x23,0x22,0x23,0x21,0x23,0x32,0x22,0x21,
    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x22,0x22,0x32,
    0x33,0x12,0x11,0x22,0x33,0x22,0x22,0x21,0x33,0x33,0x23,0x21,0x33,0x22,0x12,0x22,

    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x23,0x22,0x33,
    0x33,0x23,0x21,0x33,0x33,0x22,0x21,0x33,0x33,0x12,0x22,0x32,0x23,0x12,0x12,0x32,
    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x22,0x22,0x32,
    0x23,0x12,0x11,0x32,0x23,0x21,0x22,0x32,0x22,0x21,0x33,0x33,0x12,0x22,0x22,0x33,
    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x23,0x22,0x32,
    0x33,0x22,0x11,0x32,0x23,0x12,0x22,0x32,0x23,0x21,0x32,0x33,0x22,0x21,0x22,0x32,
    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x22,0x22,0x33,0x33,
    0x12,0x21,0x22,0x22,0x22,0x12,0x11,0x21,0x33,0x22,0x12,0x22,0x23,0x22,0x21,0x32,

    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x22,0x22,0x33,
    0x23,0x12,0x21,0x32,0x23,0x21,0x12,0x22,0x23,0x21,0x23,0x11,0x23,0x21,0x12,0x22,
    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x22,0x22,0x32,
    0x23,0x12,0x11,0x22,0x22,0x21,0x22,0x21,0x12,0x22,0x22,0x21,0x12,0x22,0x22,0x21,
    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x23,0x33,0x33,
    0x33,0x12,0x32,0x33,0x23,0x21,0x21,0x33,0x23,0x21,0x21,0x33,0x12,0x32,0x12,0x32,
    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x22,0x22,0x22,0x32,
    0x12,0x11,0x11,0x22,0x12,0x22,0x22,0x21,0x12,0x32,0x23,0x21,0x12,0x22,0x22,0x21,

    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x22,0x22,0x32,
    0x23,0x12,0x11,0x22,0x22,0x21,0x22,0x21,0x12,0x22,0x23,0x22,0x12,0x32,0x33,0x33,
    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x22,0x22,0x22,0x33,
    0x12,0x11,0x21,0x32,0x12,0x22,0x12,0x22,0x12,0x32,0x23,0x21,0x12,0x32,0x23,0x21,
    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x22,0x22,0x22,0x22,
    0x12,0x11,0x11,0x21,0x12,0x22,0x22,0x22,0x12,0x32,0x33,0x33,0x12,0x22,0x22,0x32,
    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x22,0x22,0x22,0x22,
    0x12,0x11,0x11,0x21,0x12,0x22,0x22,0x22,0x12,0x32,0x33,0x33,0x12,0x22,0x22,0x32,

    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x22,0x22,0x32,
    0x23,0x12,0x11,0x22,0x22,0x21,0x22,0x21,0x12,0x22,0x23,0x22,0x12,0x32,0x33,0x33,
    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x22,0x32,0x23,0x22,
    0x12,0x32,0x23,0x21,0x12,0x32,0x23,0x21,0x12,0x32,0x23,0x21,0x12,0x22,0x22,0x21,
    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x22,0x22,0x32,
    0x33,0x12,0x11,0x32,0x33,0x22,0x21,0x32,0x33,0x23,0x21,0x33,0x33,0x23,0x21,0x33,
    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x22,0x22,
    0x33,0x33,0x12,0x21,0x33,0x33,0x22,0x21,0x33,0x33,0x23,0x21,0x33,0x33,0x23,0x21,

    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x22,0x32,0x23,0x22,
    0x12,0x32,0x22,0x21,0x12,0x22,0x12,0x22,0x12,0x22,0x21,0x32,0x12,0x12,0x22,0x33,
    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x22,0x32,0x33,0x33,
    0x12,0x32,0x33,0x33,0x12,0x32,0x33,0x33,0x12,0x32,0x33,0x33,0x12,0x32,0x33,0x33,
    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x22,0x33,0x23,0x22,
    0x21,0x33,0x23,0x21,0x21,0x32,0x22,0x21,0x11,0x32,0x12,0x21,0x11,0x22,0x12,0x21,
    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x22,0x33,0x23,0x22,
    0x12,0x32,0x23,0x21,0x12,0x22,0x23,0x21,0x12,0x21,0x22,0x21,0x12,0x12,0x22,0x21,

    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x22,0x22,0x33,
    0x23,0x12,0x21,0x32,0x22,0x21,0x12,0x22,0x12,0x22,0x22,0x21,0x12,0x32,0x23,0x21,
    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x22,0x22,0x22,0x32,
    0x12,0x11,0x11,0x22,0x12,0x22,0x22,0x21,0x12,0x32,0x23,0x21,0x12,0x22,0x22,0x21,
    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x22,0x22,0x33,
    0x23,0x12,0x21,0x32,0x22,0x21,0x12,0x22,0x12,0x22,0x22,0x21,0x12,0x32,0x23,0x21,
    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x22,0x22,0x22,0x32,
    0x12,0x11,0x11,0x22,0x12,0x22,0x22,0x21,0x12,0x32,0x23,0x21,0x12,0x22,0x22,0x21,

    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x23,0x22,0x22,0x32,
    0x22,0x11,0x11,0x22,0x12,0x22,0x22,0x21,0x12,0x32,0x23,0x22,0x12,0x22,0x22,0x32,
    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x22,0x22,0x22,0x22,
    0x11,0x11,0x11,0x21,0x22,0x12,0x22,0x22,0x33,0x12,0x32,0x33,0x33,0x12,0x32,0x33,
    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x22,0x32,0x23,0x22,
    0x12,0x32,0x23,0x21,0x12,0x32,0x23,0x21,0x12,0x32,0x23,0x21,0x12,0x32,0x23,0x21,
    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x22,0x33,0x23,0x22,
    0x21,0x33,0x23,0x21,0x21,0x33,0x23,0x21,0x21,0x33,0x23,0x21,0x21,0x33,0x23,0x21,

    0x12,0x22,0x23,0x21,0x12,0x32,0x22,0x21,0x12,0x32,0x12,0x32,0x12,0x32,0x12,0x32,
    0x12,0x22,0x12,0x32,0x22,0x11,0x21,0x32,0x23,0x22,0x22,0x33,0x33,0x33,0x33,0x33,
    0x33,0x22,0x21,0x33,0x33,0x12,0x22,0x33,0x33,0x12,0x32,0x33,0x33,0x12,0x32,0x33,
    0x23,0x12,0x22,0x33,0x23,0x11,0x21,0x33,0x23,0x22,0x22,0x33,0x33,0x33,0x33,0x33,
    0x33,0x23,0x12,0x22,0x33,0x22,0x21,0x32,0x23,0x12,0x22,0x33,0x22,0x21,0x32,0x33,
    0x12,0x11,0x22,0x32,0x12,0x22,0x11,0x32,0x22,0x22,0x22,0x32,0x33,0x33,0x33,0x33,
    0x33,0x12,0x11,0x32,0x33,0x22,0x12,0x22,0x23,0x33,0x22,0x21,0x12,0x32,0x22,0x21,
    0x12,0x22,0x12,0x22,0x22,0x11,0x21,0x32,0x23,0x22,0x22,0x33,0x33,0x33,0x33,0x33,

    0x23,0x21,0x12,0x32,0x22,0x21,0x21,0x32,0x12,0x22,0x21,0x32,0x12,0x11,0x11,0x32,
    0x22,0x22,0x21,0x32,0x33,0x23,0x21,0x33,0x33,0x23,0x22,0x33,0x33,0x33,0x33,0x33,
    0x12,0x11,0x21,0x32,0x22,0x22,0x12,0x32,0x33,0x33,0x12,0x32,0x22,0x32,0x12,0x32,
    0x12,0x22,0x21,0x32,0x22,0x11,0x22,0x33,0x23,0x22,0x32,0x33,0x33,0x33,0x33,0x33,
    0x12,0x22,0x11,0x22,0x12,0x12,0x22,0x21,0x12,0x22,0x22,0x21,0x12,0x22,0x22,0x21,
    0x22,0x21,0x12,0x22,0x23,0x12,0x21,0x32,0x33,0x22,0x22,0x33,0x33,0x33,0x33,0x33,
    0x23,0x21,0x21,0x33,0x33,0x12,0x22,0x33,0x23,0x12,0x21,0x33,0x23,0x21,0x22,0x33,
    0x23,0x21,0x33,0x33,0x23,0x21,0x33,0x33,0x23,0x22,0x33,0x33,0x33,0x33,0x33,0x33,

    0x23,0x12,0x21,0x32,0x22,0x21,0x21,0x32,0x12,0x32,0x12,0x32,0x12,0x32,0x12,0x32,
    0x12,0x22,0x12,0x32,0x22,0x11,0x21,0x32,0x23,0x22,0x22,0x33,0x33,0x33,0x33,0x33,
    0x12,0x22,0x21,0x21,0x22,0x11,0x22,0x21,0x23,0x22,0x12,0x32,0x33,0x23,0x12,0x32,
    0x23,0x22,0x21,0x32,0x23,0x11,0x22,0x33,0x23,0x22,0x32,0x33,0x33,0x33,0x33,0x33,
    0x12,0x32,0x12,0x32,0x12,0x22,0x12,0x32,0x12,0x11,0x11,0x22,0x21,0x22,0x22,0x21,
    0x21,0x33,0x23,0x21,0x21,0x33,0x23,0x21,0x22,0x33,0x33,0x22,0x33,0x33,0x33,0x33,
    0x12,0x11,0x11,0x22,0x12,0x22,0x22,0x21,0x12,0x32,0x23,0x21,0x12,0x32,0x23,0x21,
    0x12,0x22,0x22,0x21,0x12,0x11,0x11,0x22,0x22,0x22,0x22,0x32,0x33,0x33,0x33,0x33,

    0x12,0x32,0x33,0x33,0x12,0x32,0x33,0x33,0x12,0x32,0x33,0x33,0x12,0x22,0x23,0x22,
    0x22,0x21,0x22,0x21,0x23,0x12,0x11,0x22,0x33,0x22,0x22,0x32,0x33,0x33,0x33,0x33,
    0x12,0x32,0x23,0x21,0x12,0x32,0x23,0x21,0x12,0x32,0x23,0x21,0x12,0x32,0x23,0x21,
    0x12,0x22,0x12,0x22,0x12,0x11,0x21,0x32,0x22,0x22,0x22,0x33,0x33,0x33,0x33,0x33,
    0x12,0x11,0x11,0x32,0x12,0x22,0x22,0x32,0x12,0x32,0x33,0x33,0x12,0x32,0x33,0x33,
    0x12,0x22,0x22,0x32,0x12,0x11,0x11,0x21,0x22,0x22,0x22,0x22,0x33,0x33,0x33,0x33,
    0x12,0x11,0x11,0x32,0x12,0x22,0x22,0x32,0x12,0x32,0x33,0x33,0x12,0x32,0x33,0x33,
    0x12,0x32,0x33,0x33,0x12,0x32,0x33,0x33,0x22,0x32,0x33,0x33,0x33,0x33,0x33,0x33,

    0x12,0x22,0x22,0x22,0x12,0x22,0x11,0x21,0x12,0x22,0x22,0x21,0x12,0x22,0x23,0x21,
    0x22,0x21,0x22,0x21,0x23,0x12,0x11,0x21,0x33,0x22,0x22,0x32,0x33,0x33,0x33,0x33,
    0x12,0x11,0x11,0x21,0x12,0x22,0x22,0x21,0x12,0x32,0x23,0x21,0x12,0x32,0x23,0x21,
    0x12,0x32,0x23,0x21,0x12,0x32,0x23,0x21,0x22,0x32,0x23,0x22,0x33,0x33,0x33,0x33,
    0x33,0x23,0x21,0x33,0x33,0x23,0x21,0x33,0x33,0x23,0x21,0x33,0x33,0x23,0x21,0x33,
    0x33,0x22,0x21,0x32,0x33,0x12,0x11,0x32,0x33,0x22,0x22,0x32,0x33,0x33,0x33,0x33,
    0x33,0x33,0x23,0x21,0x33,0x33,0x23,0x21,0x22,0x32,0x23,0x21,0x12,0x32,0x22,0x21,
    0x12,0x22,0x12,0x21,0x22,0x11,0x11,0x32,0x23,0x22,0x22,0x32,0x33,0x33,0x33,0x33,

    0x12,0x21,0x32,0x33,0x12,0x21,0x32,0x33,0x12,0x12,0x22,0x33,0x12,0x22,0x21,0x32,
    0x12,0x22,0x12,0x22,0x12,0x32,0x22,0x21,0x22,0x32,0x23,0x22,0x33,0x33,0x33,0x33,
    0x12,0x32,0x33,0x33,0x12,0x32,0x33,0x33,0x12,0x32,0x33,0x33,0x12,0x32,0x33,0x33,
    0x12,0x22,0x22,0x22,0x12,0x11,0x11,0x21,0x22,0x22,0x22,0x22,0x33,0x33,0x33,0x33,
    0x21,0x21,0x21,0x21,0x21,0x21,0x21,0x21,0x21,0x21,0x21,0x21,0x21,0x12,0x22,0x21,
    0x21,0x12,0x22,0x21,0x21,0x22,0x22,0x21,0x22,0x33,0x23,0x22,0x33,0x33,0x33,0x33,
    0x12,0x12,0x22,0x21,0x12,0x22,0x21,0x21,0x12,0x22,0x21,0x21,0x12,0x32,0x12,0x21,
    0x12,0x32,0x22,0x21,0x12,0x32,0x23,0x21,0x22,0x32,0x23,0x22,0x33,0x33,0x33,0x33,

    0x12,0x32,0x23,0x21,0x12,0x32,0x23,0x21,0x12,0x32,0x23,0x21,0x12,0x22,0x22,0x21,
    0x22,0x21,0x12,0x22,0x23,0x12,0x21,0x32,0x33,0x22,0x22,0x33,0x33,0x33,0x33,0x33,
    0x12,0x11,0x11,0x22,0x12,0x22,0x22,0x32,0x12,0x32,0x33,0x33,0x12,0x32,0x33,0x33,
    0x12,0x32,0x33,0x33,0x12,0x32,0x33,0x33,0x22,0x32,0x33,0x33,0x33,0x33,0x33,0x33,
    0x12,0x32,0x23,0x21,0x12,0x32,0x23,0x21,0x12,0x22,0x22,0x21,0x12,0x22,0x21,0x21,
    0x22,0x21,0x12,0x22,0x23,0x12,0x21,0x21,0x33,0x22,0x22,0x22,0x33,0x33,0x33,0x33,
    0x12,0x11,0x11,0x22,0x12,0x12,0x22,0x32,0x12,0x22,0x21,0x33,0x12,0x22,0x12,0x32,
    0x12,0x32,0x12,0x22,0x12,0x32,0x22,0x21,0x22,0x32,0x23,0x22,0x33,0x33,0x33,0x33,

    0x22,0x11,0x11,0x32,0x23,0x22,0x22,0x21,0x22,0x32,0x23,0x21,0x12,0x32,0x23,0x21,
    0x12,0x22,0x22,0x21,0x23,0x11,0x11,0x22,0x33,0x22,0x22,0x32,0x33,0x33,0x33,0x33,
    0x33,0x12,0x32,0x33,0x33,0x12,0x32,0x33,0x33,0x12,0x32,0x33,0x33,0x12,0x32,0x33,
    0x33,0x12,0x32,0x33,0x33,0x12,0x32,0x33,0x33,0x22,0x32,0x33,0x33,0x33,0x33,0x33,
    0x12,0x32,0x23,0x21,0x12,0x32,0x23,0x21,0x12,0x32,0x23,0x21,0x12,0x32,0x23,0x21,
    0x12,0x22,0x22,0x21,0x22,0x11,0x11,0x22,0x23,0x22,0x22,0x32,0x33,0x33,0x33,0x33,
    0x12,0x32,0x12,0x22,0x12,0x32,0x12,0x32,0x12,0x32,0x12,0x32,0x22,0x21,0x21,0x32,
    0x23,0x21,0x21,0x33,0x23,0x12,0x22,0x33,0x33,0x22,0x32,0x33,0x33,0x33,0x33,0x33,

    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x22,0x33,0x23,0x22,
    0x21,0x22,0x22,0x21,0x21,0x12,0x22,0x21,0x21,0x12,0x22,0x21,0x21,0x12,0x22,0x21,
    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x22,0x32,0x23,0x22,
    0x12,0x32,0x23,0x21,0x12,0x32,0x23,0x21,0x12,0x22,0x22,0x21,0x22,0x21,0x12,0x22,
    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x22,0x33,0x23,0x22,
    0x21,0x33,0x23,0x21,0x21,0x32,0x22,0x21,0x12,0x32,0x12,0x22,0x12,0x22,0x12,0x32,
    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x22,0x22,0x22,0x22,
    0x12,0x11,0x11,0x21,0x22,0x22,0x22,0x21,0x33,0x33,0x12,0x32,0x33,0x23,0x21,0x33,

    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,
    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x22,0x22,0x22,0x23,0x12,0x21,0x21,
    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,
    0x22,0x32,0x33,0x33,0x12,0x32,0x33,0x33,0x12,0x22,0x22,0x32,0x12,0x12,0x11,0x22,
    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,
    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x22,0x22,0x32,0x23,0x12,0x11,0x22,
    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x23,0x22,
    0x33,0x33,0x23,0x21,0x33,0x33,0x23,0x21,0x33,0x22,0x22,0x21,0x23,0x12,0x11,0x21,

    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,
    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x22,0x22,0x32,0x23,0x12,0x11,0x22,
    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x23,0x22,0x22,
    0x33,0x22,0x11,0x21,0x33,0x12,0x22,0x22,0x33,0x12,0x32,0x33,0x22,0x12,0x22,0x22,
    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,
    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x22,0x22,0x32,0x23,0x12,0x11,0x22,
    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x22,0x32,0x33,0x33,
    0x12,0x32,0x33,0x33,0x12,0x32,0x33,0x33,0x12,0x22,0x22,0x32,0x12,0x12,0x11,0x22,

    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x22,0x22,0x33,
    0x33,0x12,0x21,0x33,0x33,0x22,0x22,0x33,0x33,0x22,0x22,0x33,0x33,0x12,0x21,0x33,
    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x22,0x22,0x33,
    0x33,0x12,0x21,0x33,0x33,0x22,0x22,0x33,0x33,0x22,0x22,0x33,0x33,0x12,0x21,0x33,
    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x22,0x32,0x33,0x33,
    0x12,0x32,0x33,0x33,0x12,0x32,0x33,0x33,0x12,0x32,0x33,0x33,0x12,0x32,0x22,0x22,
    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x22,0x22,0x33,
    0x33,0x12,0x21,0x33,0x33,0x22,0x21,0x33,0x33,0x23,0x21,0x33,0x33,0x23,0x21,0x33,

    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,
    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x22,0x22,0x22,0x32,0x12,0x21,0x11,0x22,
    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,
    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x22,0x22,0x22,0x32,0x12,0x12,0x11,0x22,
    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,
    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x22,0x22,0x32,0x23,0x12,0x11,0x22,
    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,
    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x23,0x22,0x22,0x33,0x12,0x12,0x11,0x32,

    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,
    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x22,0x22,0x22,0x23,0x11,0x11,0x21,
    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,
    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x22,0x22,0x22,0x32,0x12,0x12,0x11,0x22,
    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,
    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x23,0x22,0x22,0x22,0x22,0x11,0x11,0x21,
    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,
    0x33,0x22,0x32,0x33,0x33,0x12,0x32,0x33,0x22,0x12,0x22,0x22,0x12,0x11,0x11,0x21,

    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,
    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x22,0x32,0x23,0x22,0x12,0x32,0x23,0x21,
    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,
    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x22,0x32,0x23,0x22,0x12,0x32,0x23,0x21,
    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,
    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x22,0x22,0x22,0x22,0x21,0x12,0x22,0x21,
    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,
    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x22,0x32,0x33,0x22,0x12,0x22,0x22,0x21,

    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,
    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x22,0x32,0x23,0x22,0x12,0x22,0x23,0x21,
    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,
    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x22,0x22,0x22,0x22,0x12,0x11,0x11,0x21,
    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,
    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,
    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,
    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,

    0x21,0x12,0x22,0x21,0x21,0x21,0x21,0x21,0x21,0x21,0x21,0x21,0x11,0x22,0x12,0x21,
    0x11,0x22,0x12,0x21,0x21,0x22,0x22,0x21,0x22,0x33,0x23,0x22,0x33,0x33,0x33,0x33,
    0x23,0x12,0x21,0x32,0x23,0x12,0x21,0x32,0x22,0x21,0x12,0x22,0x12,0x32,0x23,0x21,
    0x12,0x32,0x23,0x21,0x12,0x32,0x23,0x21,0x22,0x32,0x23,0x22,0x33,0x33,0x33,0x33,
    0x22,0x21,0x21,0x32,0x23,0x21,0x21,0x33,0x23,0x12,0x22,0x33,0x33,0x12,0x32,0x33,
    0x33,0x12,0x32,0x33,0x33,0x12,0x32,0x33,0x33,0x22,0x32,0x33,0x33,0x33,0x33,0x33,
    0x33,0x23,0x21,0x33,0x33,0x12,0x32,0x33,0x23,0x21,0x33,0x33,0x23,0x21,0x33,0x33,
    0x12,0x22,0x22,0x22,0x12,0x11,0x11,0x21,0x22,0x22,0x22,0x22,0x33,0x33,0x33,0x33,

    0x22,0x21,0x12,0x21,0x12,0x32,0x22,0x21,0x12,0x32,0x23,0x21,0x12,0x32,0x22,0x21,
    0x12,0x22,0x12,0x21,0x22,0x11,0x21,0x21,0x23,0x22,0x22,0x22,0x33,0x33,0x33,0x33,
    0x12,0x21,0x22,0x21,0x12,0x22,0x23,0x21,0x12,0x32,0x23,0x31,0x12,0x32,0x23,0x21,
    0x12,0x22,0x22,0x21,0x12,0x11,0x11,0x22,0x22,0x22,0x22,0x32,0x33,0x33,0x33,0x33,
    0x22,0x21,0x22,0x21,0x12,0x32,0x23,0x22,0x12,0x32,0x33,0x33,0x12,0x32,0x23,0x22,
    0x12,0x22,0x22,0x21,0x22,0x11,0x11,0x22,0x23,0x22,0x22,0x32,0x33,0x33,0x33,0x33,
    0x22,0x21,0x22,0x21,0x12,0x22,0x23,0x21,0x12,0x32,0x23,0x21,0x12,0x32,0x22,0x21,
    0x12,0x22,0x12,0x21,0x22,0x11,0x21,0x21,0x23,0x22,0x22,0x22,0x33,0x33,0x33,0x33,

    0x22,0x21,0x22,0x21,0x12,0x22,0x22,0x21,0x12,0x12,0x11,0x22,0x12,0x22,0x22,0x22,
    0x12,0x22,0x22,0x21,0x22,0x11,0x11,0x22,0x23,0x22,0x22,0x32,0x33,0x33,0x33,0x33,
    0x12,0x11,0x11,0x21,0x22,0x12,0x22,0x22,0x33,0x12,0x32,0x33,0x33,0x12,0x32,0x33,
    0x33,0x12,0x32,0x33,0x33,0x12,0x32,0x33,0x33,0x22,0x32,0x33,0x33,0x33,0x33,0x33,
    0x22,0x21,0x22,0x21,0x12,0x22,0x23,0x21,0x12,0x32,0x22,0x21,0x12,0x22,0x12,0x21,
    0x22,0x11,0x21,0x21,0x23,0x22,0x22,0x21,0x23,0x11,0x11,0x22,0x23,0x22,0x22,0x32,
    0x12,0x21,0x22,0x21,0x12,0x32,0x23,0x21,0x12,0x32,0x23,0x21,0x12,0x32,0x23,0x21,
    0x12,0x32,0x23,0x21,0x12,0x32,0x23,0x21,0x22,0x32,0x23,0x22,0x33,0x33,0x33,0x33,

    0x33,0x22,0x21,0x33,0x33,0x23,0x21,0x33,0x33,0x23,0x21,0x33,0x33,0x23,0x21,0x33,
    0x33,0x22,0x21,0x32,0x33,0x12,0x11,0x32,0x33,0x22,0x22,0x32,0x33,0x33,0x33,0x33,
    0x33,0x22,0x21,0x33,0x33,0x23,0x21,0x33,0x33,0x23,0x21,0x33,0x33,0x23,0x21,0x33,
    0x33,0x22,0x21,0x33,0x22,0x12,0x22,0x33,0x12,0x21,0x32,0x33,0x22,0x22,0x33,0x33,
    0x12,0x22,0x12,0x21,0x12,0x12,0x21,0x22,0x12,0x21,0x22,0x33,0x12,0x21,0x22,0x33,
    0x12,0x12,0x21,0x22,0x12,0x22,0x12,0x21,0x22,0x32,0x22,0x22,0x33,0x33,0x33,0x33,
    0x33,0x23,0x21,0x33,0x33,0x23,0x21,0x33,0x33,0x23,0x21,0x33,0x33,0x23,0x21,0x33,
    0x33,0x23,0x21,0x33,0x33,0x23,0x21,0x33,0x33,0x23,0x22,0x33,0x33,0x33,0x33,0x33,

    0x21,0x12,0x22,0x21,0x21,0x12,0x22,0x21,0x21,0x12,0x22,0x21,0x21,0x12,0x22,0x21,
    0x21,0x12,0x22,0x21,0x21,0x12,0x22,0x21,0x22,0x22,0x22,0x22,0x33,0x33,0x33,0x33,
    0x12,0x21,0x22,0x21,0x12,0x22,0x23,0x21,0x12,0x32,0x23,0x21,0x12,0x32,0x23,0x21,
    0x12,0x32,0x23,0x21,0x12,0x32,0x23,0x21,0x22,0x32,0x23,0x22,0x33,0x33,0x33,0x33,
    0x22,0x21,0x22,0x21,0x12,0x32,0x23,0x21,0x12,0x32,0x23,0x21,0x12,0x32,0x23,0x21,
    0x12,0x22,0x22,0x21,0x22,0x11,0x11,0x22,0x23,0x22,0x22,0x32,0x33,0x33,0x33,0x33,
    0x12,0x21,0x22,0x21,0x12,0x22,0x22,0x21,0x12,0x32,0x23,0x21,0x12,0x21,0x22,0x21,
    0x12,0x12,0x11,0x22,0x12,0x22,0x22,0x32,0x12,0x32,0x33,0x33,0x22,0x32,0x33,0x33,

    0x12,0x22,0x22,0x21,0x12,0x32,0x23,0x21,0x12,0x32,0x23,0x21,0x12,0x22,0x12,0x21,
    0x22,0x11,0x21,0x21,0x23,0x22,0x22,0x21,0x33,0x33,0x23,0x21,0x33,0x33,0x23,0x22,
    0x12,0x21,0x22,0x21,0x12,0x22,0x23,0x22,0x12,0x32,0x33,0x33,0x12,0x32,0x33,0x33,
    0x12,0x32,0x33,0x33,0x12,0x32,0x33,0x33,0x22,0x32,0x33,0x33,0x33,0x33,0x33,0x33,
    0x12,0x22,0x22,0x22,0x12,0x22,0x22,0x32,0x22,0x11,0x11,0x22,0x23,0x22,0x22,0x21,
    0x22,0x22,0x22,0x21,0x12,0x11,0x11,0x22,0x22,0x22,0x22,0x32,0x33,0x33,0x33,0x33,
    0x22,0x12,0x22,0x22,0x33,0x12,0x32,0x33,0x33,0x12,0x32,0x33,0x33,0x12,0x32,0x33,
    0x33,0x12,0x22,0x22,0x33,0x22,0x11,0x21,0x33,0x23,0x22,0x22,0x33,0x33,0x33,0x33,

    0x12,0x32,0x23,0x21,0x12,0x32,0x23,0x21,0x12,0x32,0x23,0x21,0x12,0x32,0x23,0x21,
    0x12,0x22,0x22,0x21,0x22,0x11,0x11,0x22,0x23,0x22,0x22,0x32,0x33,0x33,0x33,0x33,
    0x12,0x22,0x22,0x21,0x22,0x21,0x12,0x22,0x23,0x21,0x12,0x32,0x23,0x21,0x12,0x32,
    0x23,0x12,0x21,0x32,0x33,0x12,0x21,0x33,0x33,0x22,0x22,0x33,0x33,0x33,0x33,0x33,
    0x21,0x12,0x22,0x21,0x21,0x12,0x22,0x21,0x21,0x12,0x22,0x21,0x21,0x21,0x21,0x21,
    0x11,0x21,0x11,0x21,0x12,0x22,0x12,0x32,0x22,0x32,0x22,0x32,0x33,0x33,0x33,0x33,
    0x22,0x21,0x12,0x22,0x23,0x21,0x12,0x32,0x23,0x12,0x21,0x32,0x23,0x21,0x12,0x32,
    0x22,0x21,0x12,0x22,0x12,0x22,0x22,0x21,0x22,0x32,0x23,0x22,0x33,0x33,0x33,0x33,

    0x22,0x21,0x22,0x21,0x23,0x21,0x12,0x22,0x33,0x12,0x12,0x32,0x33,0x22,0x21,0x32,
    0x33,0x12,0x22,0x33,0x23,0x12,0x32,0x33,0x23,0x21,0x32,0x33,0x23,0x22,0x33,0x33,
    0x22,0x22,0x12,0x22,0x33,0x22,0x21,0x32,0x23,0x12,0x22,0x33,0x22,0x21,0x32,0x33,
    0x12,0x22,0x22,0x22,0x12,0x11,0x11,0x21,0x22,0x22,0x22,0x22,0x33,0x33,0x33,0x33,
    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x22,0x33,0x33,
    0x23,0x11,0x32,0x33,0x23,0x11,0x32,0x33,0x33,0x22,0x33,0x33,0x33,0x33,0x33,0x33,
    0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,
    0x13,0x31,0x33,0x33,0x13,0x31,0x33,0x33,0x33,0x31,0x33,0x33,0x13,0x33,0x33,0x33,
};

const unsigned char FontPal[32] __attribute__((aligned(4)))=
{
    0xE0,0x03,0xFF,0x7F,0x18,0x2A,0x00,0x54,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
};

// vanilla frame operation stuff
#define sub_806E08C ((void (*)()) 0x806E08D)

// Room warp stuff
struct EnemyDataStructure {
    unsigned short CurEnemy_usStatus;
    unsigned char pAnmData1;
    unsigned char pAnmData2;
    unsigned long OAMDataPackPointerForCurrentAnimation;
    unsigned short CurEnemy_YPos;
    unsigned short CurEnemy_XPos;
    unsigned short CurEnemy_AffinePA;
    unsigned short CurEnemy_AffinePB;
    unsigned short CurEnemy_AffinePC;
    unsigned short CurEnemy_AffinePD;
    unsigned short CurEnemy_CurrentAnimationFrameId;
    unsigned char CurEnemy_RealFrameCountForCurrentAnimationFrame;
    unsigned char CurEnemy_GlobalId;
    unsigned char CurEnemy_RoomEntitySlotId;
    unsigned char CurEnemy_ucChrOfs;
    unsigned char CurEnemy_Prio;
    unsigned char CurEnemy_paletteId;
    unsigned char CurEnemy_CurrentAnimationId;
    unsigned char CurEnemy_Life;
    unsigned char CurEnemy_GuardAndDamageParam;
    unsigned char CurEnemy_DisableInteractionWithWarioCountdown;
    unsigned char CurEnemy_SizeY0_Bottom;
    unsigned char CurEnemy_SizeY1_Top;
    unsigned char CurEnemy_SizeX_LeftRight;
    unsigned char CurEnemy_HitboxY0;
    unsigned char CurEnemy_HitboxY1;
    unsigned char CurEnemy_HitboxX0;
    unsigned char CurEnemy_HitboxX1;
    unsigned char CurEnemy_TWork0;
    unsigned char CurEnemy_TWork1;
    unsigned char CurEnemy_TWork2;
    unsigned char CurEnemy_TWork3;
    unsigned char CurEnemy_padding;
};
#define ENTITIES ((volatile struct EnemyDataStructure*) 0x3000104)

#define WarioState (*(volatile unsigned char*) 0x3001898)
#define WarioXPos (*(volatile unsigned short*) 0x30018AA)
#define WarioYPos (*(volatile unsigned short*) 0x30018AC)

// 00(Entry) 01(Emerald) 02(Ruby) 03(Topaz) 04(Sapphire) 05(Golden) 06(Sound Room)
#define CurrentPassage (*(volatile unsigned char*) 0x3000002)
// 00(first lvl) 01(second lvl) 02(third lvl) 03(fourth lvl) 04(Boss) 05(Mini-Game Shop)
#define CurrentLevel (*(volatile unsigned char*) 0x3000003)
#define CurrentRoom (*(volatile unsigned char*) 0x03000024)

int ASCII_to_id(char ascii_char)
{
    if (ascii_char >= 0x30 && ascii_char <= 0x39) // '0' - '9'
    {
        return (ascii_char - 0x30);
    }
    else if (ascii_char >= 0x41 && ascii_char <= 0x5A) // 'A' - 'Z'
    {
        return (ascii_char - 0x41 + 10);
    }
    else if (ascii_char >= 0x61 && ascii_char <= 0x7A) // 'a' - 'z'
    {
        return (ascii_char - 0x61 + 10 + 26);
    }
    else if (ascii_char == 0x2C) // comma
    {
        return (10 + 2 * 26 + 1);
    }
    else if (ascii_char == 0x2E) // point
    {
        return (10 + 2 * 26);
    }
    else // anything else become space (which is 0x20 in ascii)
    {
        return 0xff;
    }
}

int id_to_tile_offset_upper(int id)
{
    if (id > 31 && id < 64)
    {
        return (32 * 2 + (id - 32));
    }
    else if (id <= 31)
    {
        return id;
    }
    else
    {
        return (32 * 3 - 2);
    }
}

int id_to_tile_offset_lower(int id)
{
    if (id > 31 && id < 64)
    {
        return (32 * 3 + (id - 32));
    }
    else if (id <= 31)
    {
        return 32 + id;
    }
    else
    {
        return (32 * 3 - 2);
    }
}

int offset_to_real_id(int offset)
{
    // 32 * 4 = 128 == 0x80
    // real id 0x3fe == offset 0x7f
    return 0x3fe - (0x7f - offset);
}

const unsigned char nothing_here[] = "hint-kun is sleeping. dont wake him up.";
const unsigned char debug_room_text[] = "1. This is the debug Room, you can see how those custom stuff be tested here. "
                                "then you can feel my pain on how hard all those edge cases need to deal with for the new carpet."
                                "              2. Press L button to show hints for the Room, tho i sometimes will just wrote some "
                                "other things in the hint box. lol. press L button again to show more text.              "
                                "3. In any other Room except this one, you can "
                                "press SELECT button to retry that Room, while the switch will be reset but progress will be saved. "
                                "wario will come out from the last warp door he just used."
                                "now no one can complain softlocks. ha ha ha ha ha...           4. bgm by Debussy, "
                                "Suite Bergamasque part 4, Passepied, at 1905.";
const unsigned char room_1_text[] = "dont ask me why burning wario will bonk on the right wall, but not bonk on the left wall when on the carpet. "
                                    "thats some vanilla game mechanism...";
const unsigned char room_3_text[] = "okay, hold right and up, or left and up to let it work.";
const unsigned char room_5_text[] = "I want to say that, you can break a hard breakable block from below when you are on a carpet. Hmmm, "
                                    "you want to say this is not the hint you want and you dont know how to get rid of the carpet in snow wario stats... "
                                    "okay, the hint is land on the ground first then move...";
const unsigned char room_6_text[] = "All the R block will revive when you refresh the level.";
const unsigned char room_8_text[] = "Question 1: why zombie wario will become fluid.         "
                                    "Quesrion 2: why you spend time reading these while the timer is still flying.";
const unsigned int Room_texts[] = {debug_room_text, room_1_text, nothing_here, room_3_text, nothing_here, room_5_text, room_6_text, 
                                    nothing_here, room_8_text, nothing_here, nothing_here, nothing_here, nothing_here, nothing_here, nothing_here, 
                                    nothing_here};
#define max_line (15 * 2)
#define max_col 10
#define border_padding 1
#define start_addr ((volatile unsigned char*) 0x6003000)
void ManageText()
{
    // init the vram
    for (int c = 0; c < max_col; c++)
    {
        for (int i = 0; i < max_line; i++)
        {
            unsigned char *cur_addr = start_addr + 2 * 0x40 * c + 2 * i;
            unsigned short *cur_short_1 = cur_addr;
            unsigned short *cur_short_2 = cur_short_1 + 0x20;
            *cur_short_1 = 0xF3FF;
            *cur_short_2 = 0xF3FF;
        }
    }
    // write text into vram
    unsigned int current_line_num = 0;
    unsigned char no_more_letter = 0;
    unsigned char *text = (unsigned char *) Room_texts[CurrentRoom];
    for (int c = 0; c < (max_col - 2 * border_padding); c++)
    {
        for (int i = 0; i < (max_line - 2 * border_padding); i++)
        {
            unsigned int cur_char_id = c * (max_line - 2 * border_padding) + i + unk_3000039 * (max_col - 2 * border_padding) * (max_line - 2 * border_padding);
            unsigned char *cur_addr = start_addr + 2 * 0x40 * (c + border_padding) + 2 * (i + border_padding);
            unsigned short *cur_short_1 = cur_addr;
            unsigned short *cur_short_2 = cur_short_1 + 0x20;
            if (text[cur_char_id] != '\0' && no_more_letter == 0)
            {
                unsigned short cur_text_1 = 0xF000 | offset_to_real_id(id_to_tile_offset_upper(ASCII_to_id(text[cur_char_id])));
                unsigned short cur_text_2 = 0xF000 | offset_to_real_id(id_to_tile_offset_lower(ASCII_to_id(text[cur_char_id])));
                *cur_short_1 = cur_text_1;
                *cur_short_2 = cur_text_2;
            }
            else
            {
                *cur_short_1 = 0xF3FF;
                *cur_short_2 = 0xF3FF;
                no_more_letter = 1;
                unk_3000039 = 0;
            }
        }
    }
    if (no_more_letter == 0)
    {
        unk_3000039++;
    }
}

#define REG_BG3HOFS (*(volatile unsigned int*) 0x400001C)
#define REG_BG3VOFS (*(volatile unsigned int*) 0x400001E)
#define REG_DMA3SAD (*(volatile unsigned int*) 0x40000D4)
#define REG_DMA3DAD (*(volatile unsigned int*) 0x40000D8)
#define REG_DMA3CNT (*(volatile unsigned int*) 0x40000DC)
#define usBg3Hofs (*(volatile unsigned short*) 0x40018B2)
#define usBg3Vofs (*(volatile unsigned short*) 0x40018B4)
#define Sub_806D3A4_DMACOPY_Interval_Wait ((int (*)()) 0x806D3A5)
void RenderMyLayer3()
{
    REG_BG3HOFS = 0;
    REG_BG3VOFS = 0;
    usBg3Hofs = 0;
    usBg3Vofs = 0;

    // load tile data
    unsigned int bgTileDataAddr = FontTiles;
    unsigned int bgTileDataLen = 4096; // number of byte
    REG_DMA3SAD = bgTileDataAddr;
    REG_DMA3DAD = 0x600FFE0 - bgTileDataLen;
    REG_DMA3CNT = (bgTileDataLen >> 1) | 0x80000000;
    Sub_806D3A4_DMACOPY_Interval_Wait();
    // load palette data
    unsigned int TilesetPaletteDataAddr = FontPal;
    REG_DMA3SAD = TilesetPaletteDataAddr;
    REG_DMA3DAD = 0x50001E0; // always use the last palette
    REG_DMA3CNT = (32 >> 1) | 0x80000000;
    Sub_806D3A4_DMACOPY_Interval_Wait();

    // load text
    ManageText();
}

#define TilesetHeaderDataTable ((volatile unsigned int*) 0x83F2298)
#define Sub_806BDF8_MapLH_kaitou_RLEDecompress ((unsigned short (*)(int, unsigned int*, unsigned int)) 0x806BDF9)
#define Sub_806AF4C_GmapInit_Priority_Blend ((void (*)()) 0x806AF4D)
void RenderVanillaLayer3()
{
    // logic from Sub_806B410_GmapInit()
    // load bg tile data
    unsigned int bgTileDataAddr = *(TilesetHeaderDataTable + CurrentRoomHeader_TilesetId * 9 + 3);
    unsigned int bgTileDataLen = *(TilesetHeaderDataTable + CurrentRoomHeader_TilesetId * 9 + 4); // number of byte
    REG_DMA3SAD = bgTileDataAddr;
    REG_DMA3DAD = 0x600FFE0 - bgTileDataLen;
    REG_DMA3CNT = (bgTileDataLen >> 1) | 0x80000000;
    Sub_806D3A4_DMACOPY_Interval_Wait();
    // load palette data
    unsigned int TilesetPaletteDataAddr = *(TilesetHeaderDataTable + CurrentRoomHeader_TilesetId * 9 + 2);
    REG_DMA3SAD = TilesetPaletteDataAddr;
    REG_DMA3DAD = 0x5000000;
    REG_DMA3CNT = 0x80000100;
    Sub_806D3A4_DMACOPY_Interval_Wait();
    // also the first color in palettes[0] needs to be black which is the real background color
    unsigned short *first_color_addr = 0x5000000;
    *first_color_addr = 0;
    
    // logic from Sub_806B71C_GmapStageSetAll_DecompressLayer023() in Sub_806B410_GmapInit()
    if (CurrentRoomHeader_Layer3MappingType)
    {
        unsigned short v0 = Sub_806BDF8_MapLH_kaitou_RLEDecompress(0, *CurrentRoomHeader_Layer3CompressedDataPointer, 0x201F040);
        REG_DMA3SAD = 0x201F040;
        REG_DMA3DAD = 0x6003000;
        REG_DMA3CNT = (v0 >> 1) | 0x80000000;
        Sub_806D3A4_DMACOPY_Interval_Wait();
    }
}

#define cGmStartFlg (*(volatile unsigned char*) 0x3000C3F)
#define cPauseFlag (*(volatile unsigned char*) 0x3000C35)
#define soft_reset (*(volatile unsigned char*) 0x300001E)
#define usTrg_KeyPress1Frame (*(volatile unsigned short*) 0x3001848)
#define KEY_L        0x200 // L
#define KEY_R        0x100 // R
#define KEY_A        0x001 // A
#define KEY_B        0x002 // B
#define KEY_DOWN     0x080 // Down
#define KEY_UP       0x040 // Up
#define KEY_LEFT     0x020 // Left
#define KEY_RIGHT    0x010 // Right
#define KEY_START    0x008 // Start
#define KEY_SELECT   0x004 // Select
#define KEY_ALL      0x3FF // Any key
#define usWarStopFlg (*(volatile unsigned short*) 0x30019F6)

#define Sub_806B3E8_GmapInit_ASC_Size_Check ((int (*)(unsigned char bg3_size_param)) 0x806B3E9)
#define Sub_8001DA4_m4aSongNumStart ((void (*)(int)) 0x8001DA5)

void layer_priority_changes()
{
    // Press L to trigger text rendering stuff
    if(cGmStartFlg == 1 && cPauseFlag == 0 && soft_reset == 0)
    {
        if(usTrg_KeyPress1Frame == 0x200 && !usWarStopFlg)
        {
            // logic to calculate the layer priority using RoomHeader from Sub_806AF4C_GmapInit_Priority_Blend
            unsigned short v1, BG0CNT, BG1CNT, BG2CNT, BG3CNT;
            ucObjPriFlg = 0;
            if ( (CurrentRoomHeader_Layer0MappingType & 0x20) != 0 )
                BG0CNT = Sub_806B3E8_GmapInit_ASC_Size_Check(**CurrentRoomHeader_Layer0CompressedDataPointer) | 8;
            else
                BG0CNT = 0x4004;
            BG1CNT = 0x4204;
            BG2CNT = 0x4404;
            BG3CNT = 0x603;
            if ( CurrentRoomHeader_Layer3MappingType == 0x20 )
                v1 = 8;
            else
                v1 = 4;
            BG3CNT = v1 | 0x603;
            BG3CNT = Sub_806B3E8_GmapInit_ASC_Size_Check(**CurrentRoomHeader_Layer3CompressedDataPointer) | v1 | 0x603;
            switch ( CurrentRoomHeader_LayerPriorityALphaParam )// priority
            {
                case 5:
                case 9:
                case 0xD:
                case 0x11:
                case 0x15:
                case 0x19:
                case 0x1D:
                case 0x21:
                case 0x25:
                case 0x29:
                case 0x2D:
                case 0x31:
                BG0CNT |= 1u;
                goto LABEL_12;
                case 6:
                case 0xA:
                case 0xE:
                case 0x12:
                case 0x16:
                case 0x1A:
                case 0x1E:
                case 0x22:
                case 0x26:
                case 0x2A:
                case 0x2E:
                case 0x32:
                BG0CNT |= 1u;
                BG2CNT |= 2u;
                ucObjPriFlg = 1;
                break;
                case 7:
                case 0xB:
                case 0xF:
                case 0x13:
                case 0x17:
                case 0x1B:
                case 0x1F:
                case 0x23:
                case 0x27:
                case 0x2B:
                case 0x2F:
                case 0x33:
                BG0CNT |= 2u;
                BG2CNT |= 1u;
                ucObjPriFlg = 1;
                break;
                default:
                BG1CNT |= 1u;
            LABEL_12:
                BG2CNT |= 2u;
                break;
            }
            
            if(unk_300001F == 0 || unk_3000039)
            {
                Sub_8001DA4_m4aSongNumStart(288); // open textbox sound and show next page sound
                unk_300001F = 1;
                // change layer priority, set layer 3 on the top
                BG3CNT = 8 | 0x603;
                REG_BG3CNT = (BG3CNT & 0xFFFFFFFC) | 0;
                REG_BG0CNT = (BG0CNT & 0xFFFFFFFC) | ((BG0CNT & 3) + 1);
                REG_BG1CNT = (BG1CNT & 0xFFFFFFFC) | ((BG1CNT & 3) + 1);
                REG_BG2CNT = (BG2CNT & 0xFFFFFFFC) | ((BG2CNT & 3) + 1);
                RenderMyLayer3();
            }
            else if(unk_300001F == 1)
            {
                Sub_8001DA4_m4aSongNumStart(289); // close textbox sound
                unk_300001F = 0;
                // use the default priority settings
                REG_BG3CNT = BG3CNT;
                REG_BG0CNT = BG0CNT;
                REG_BG1CNT = BG1CNT;
                REG_BG2CNT = BG2CNT;
                RenderVanillaLayer3();
            }
        }
    }
}

#define Sub_8012BAC_GmWarioChng ((void (*)(unsigned char)) 0x8012BAD)
#define Sub_806DF3C_PanelPartWork_ReBlock_operate ((void (*)(unsigned char)) 0x806DF3D)

void FrameOperations()
{
    // vanilla code for animated tiles loading
    if ( (GameState == 2 || GameState == 6 || GameState == 4 && unk_300001B == 1) && !unk_3000046 )
    {
        sub_806E08C();
    }

    // Press SELECT to restart the current room, should not work in Room 0
    if (CurrentRoom)
    {
        if(cGmStartFlg == 1 && cPauseFlag == 0 && soft_reset == 0)
        {
            if((usTrg_KeyPress1Frame & KEY_SELECT) && !usWarStopFlg) // press KEY_SELECT, and another condition
            {
                GameState = 0;
                WarioState = 0;
                Sub_8012BAC_GmWarioChng(0); // stand still, make sure wario won't spawn in water
                Sub_806DF3C_PanelPartWork_ReBlock_operate(0); // revive blocks
                Sub_8001DA4_m4aSongNumStart(368);
            }
        }
    }

    // text stuff on layer 3
    layer_priority_changes();

    // Entry Passage - Level 0
    if (!CurrentPassage && !CurrentLevel)
    {
        // Room 2 and Room 11, horizontal Room insta warp
        if (CurrentRoom == 2 || CurrentRoom == 4 || CurrentRoom == 8 || CurrentRoom == 11)
        {
            // if wario is standing on some enemy, we need to make sure they warp at the same time
            char enemy_id_wario_is_on = -1;
            unsigned char wario_should_warp = 0;

            if (WarioXPos <= (0x0040 + 0x20))
            {
                wario_should_warp = 1;
            }
            else if (WarioXPos >= (0x0470 + 0x20))
            {
                wario_should_warp = 2;
            }
            for (int c = 0 ; c < 24 ; c ++)
            {
                if ((ENTITIES[c].CurEnemy_usStatus & 1) == 0)
                {
                    continue;
                }
                
                // wario is on some enemy
                if ((ENTITIES[c].CurEnemy_TWork1 && ENTITIES[c].CurEnemy_GlobalId == 0x26) || (ENTITIES[c].CurEnemy_usStatus & 0x1000))
                {
                    enemy_id_wario_is_on = c;
                }
                if ((ENTITIES[c].CurEnemy_XPos <= (0x0040 + 0x20)) || (enemy_id_wario_is_on == c && wario_should_warp == 1))
                {
                    ENTITIES[c].CurEnemy_XPos = (0x046F + 0x20);
                    if (enemy_id_wario_is_on == c)
                    {
                        wario_should_warp = 1;
                        ENTITIES[c].CurEnemy_XPos -= 8;
                    }
                }
                else if ((ENTITIES[c].CurEnemy_XPos >= (0x0470 + 0x20)) || (enemy_id_wario_is_on == c && wario_should_warp == 2))
                {
                    ENTITIES[c].CurEnemy_XPos = (0x0041 + 0x20);
                    if (enemy_id_wario_is_on == c)
                    {
                        wario_should_warp = 2;
                        ENTITIES[c].CurEnemy_XPos += 8;
                    }
                }
            }

            if (wario_should_warp == 1)
            {
                WarioXPos = (0x046F + 0x20);
            }
            else if (wario_should_warp == 2)
            {
                WarioXPos = (0x0041 + 0x20);
            }
        }
    }
}
